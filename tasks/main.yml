---
- name: GEARMAN SERVER ROLE | Install list of gearmand server nessesary packages
  apt: name={{item}}
  with_items:
    - gcc
    - g++
    - libboost-dev
    - libboost-program-options-dev
    - libboost-all-dev
    - libevent-dev
    - cloog-ppl
    - gperf
    - uuid-dev
    - libgearman-dev

- unarchive:
   src: https://launchpad.net/gearmand/1.2/1.1.12/+download/gearmand-1.1.12.tar.gz
   dest: /opt/
   remote_src: true

- name: GEARMAN SERVER ROLE | Configure
  command: chdir=/opt/gearmand-1.1.12 ./configure

- name: GEARMAN SERVER ROLE | Make Gearman
  command: chdir=/opt/gearmand-1.1.12 make

- name: GEARMAN SERVER ROLE | Make Install The Gearman
  command: chdir=/opt/gearmand-1.1.12 make install

- name: GEARMAN SERVER ROLE | Ldconfig Install The Gearman
  command: chdir=/opt/gearmand-1.1.12 ldconfig

- template:
    src: ../templates/etc/init.d/gearmand.j2
    dest: /etc/init.d/gearmand
    owner: root
    group: root
    mode: "u=rwx,go=rx"

- name: GEARMAN SERVER ROLE | Update script list
  command: update-rc.d -f gearmand defaults

- name: GEARMAN SERVER ROLE | Ensure gearmand is restarted
  action: service name=gearmand state=restarted
